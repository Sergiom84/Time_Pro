{% extends "base.html" %}
{% block title %}Exportar a Excel - Admin{% endblock %}
{% block header %}<span class="text-timetracker-primary">Exportar Registros</span>{% endblock %}

{% block content %}
<section class="bg-gray-900 shadow-md rounded-lg p-6 mb-8">
    <form method="POST" action="{{ url_for('export.export_excel') }}">

        <!-- Secci贸n 1: Exportar por Empleado -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-200 mb-4"> Exportar por Empleado</h2>

            <div class="grid grid-cols-1 md:grid-cols-{{ '4' if plan_config.show_center_selector else '3' }} gap-4 items-end">

                {% if plan_config.show_center_selector %}
                <!-- Centro (solo en versi贸n Pro) -->
                <div>
                    <label for="centro1" class="block text-gray-400 text-sm font-bold mb-2">{{ plan_config.center_label }}</label>
                    <select id="centro1" name="centro1" class="w-full px-3 py-2 rounded bg-gray-800 text-gray-300 border border-gray-700">
                        {% if centro_admin %}
                            <option value="{{ centro_admin }}" selected>{{ centro_admin }}</option>
                        {% else %}
                            <option value="">Todos</option>
                            <option value="Centro 1">Centro 1</option>
                            <option value="Centro 2">Centro 2</option>
                            <option value="Centro 3">Centro 3</option>
                        {% endif %}
                    </select>
                </div>
                {% endif %}

                <!-- Empleado -->
                <div>
                    <label for="empleado1" class="block text-gray-400 text-sm font-bold mb-2">Empleado</label>
                    <select id="empleado1" name="empleado1" class="w-full px-3 py-2 rounded bg-gray-800 text-gray-300 border border-gray-700">
                        <option value="">Seleccionar empleado...</option>
                        {% for user in users %}
                        <option value="{{ user.id }}">{{ user.full_name }} ({{ user.username }})</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Fecha Inicio -->
                <div>
                    <label for="fecha_inicio1" class="block text-gray-400 text-sm font-bold mb-2">Desde</label>
                    <input type="date" id="fecha_inicio1" name="fecha_inicio1"
                           class="w-full px-3 py-2 rounded bg-gray-800 text-gray-300 border border-gray-700">
                </div>

                <!-- Fecha Fin -->
                <div>
                    <label for="fecha_fin1" class="block text-gray-400 text-sm font-bold mb-2">Hasta</label>
                    <input type="date" id="fecha_fin1" name="fecha_fin1"
                           class="w-full px-3 py-2 rounded bg-gray-800 text-gray-300 border border-gray-700">
                </div>
            </div>

            <!-- Botones de acci贸n -->
            <div class="flex gap-3 mt-4">
                <button type="submit" name="excel_empleado_diario" value="1"
                        class="flex-1 px-6 py-3 text-white font-semibold rounded transition-all hover:opacity-90 flex items-center justify-center gap-2"
                        style="background-color: var(--accent-primary);">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Excel Diario
                </button>
                <button type="submit" name="pdf_empleado_diario" value="1"
                        class="flex-1 px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded transition-all flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                    </svg>
                    PDF Diario
                </button>
            </div>
        </div>

        <!-- Secci贸n 2: Exportar por Estado -->
        <div class="bg-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-200 mb-4"> Exportar por Estado</h2>

            <div class="grid grid-cols-1 md:grid-cols-{{ '4' if plan_config.show_center_selector else '3' }} gap-4 items-end">

                {% if plan_config.show_center_selector %}
                <!-- Centro (solo en versi贸n Pro) -->
                <div>
                    <label for="centro2" class="block text-gray-400 text-sm font-bold mb-2">{{ plan_config.center_label }}</label>
                    <select id="centro2" name="centro2" class="w-full px-3 py-2 rounded bg-gray-800 text-gray-300 border border-gray-700">
                        {% if centro_admin %}
                            <option value="{{ centro_admin }}" selected>{{ centro_admin }}</option>
                        {% else %}
                            <option value="">Todos</option>
                            <option value="Centro 1">Centro 1</option>
                            <option value="Centro 2">Centro 2</option>
                            <option value="Centro 3">Centro 3</option>
                        {% endif %}
                    </select>
                </div>
                {% endif %}

                <!-- Estado -->
                <div>
                    <label for="estado" class="block text-gray-400 text-sm font-bold mb-2">Estado</label>
                    <select id="estado" name="estado" class="w-full px-3 py-2 rounded bg-gray-800 text-gray-300 border border-gray-700">
                        <option value="Trabajado">Trabajado</option>
                        <option value="Vacaciones">Vacaciones</option>
                        <option value="Baja">Bajas</option>
                        <option value="Ausente">Ausencias</option>
                    </select>
                </div>

                <!-- Fecha Inicio -->
                <div>
                    <label for="fecha_inicio2" class="block text-gray-400 text-sm font-bold mb-2">Desde</label>
                    <input type="date" id="fecha_inicio2" name="fecha_inicio2"
                           class="w-full px-3 py-2 rounded bg-gray-800 text-gray-300 border border-gray-700">
                </div>

                <!-- Fecha Fin -->
                <div>
                    <label for="fecha_fin2" class="block text-gray-400 text-sm font-bold mb-2">Hasta</label>
                    <input type="date" id="fecha_fin2" name="fecha_fin2"
                           class="w-full px-3 py-2 rounded bg-gray-800 text-gray-300 border border-gray-700">
                </div>
            </div>

            <!-- Bot贸n de acci贸n -->
            <div class="mt-4">
                <button type="submit" name="excel_por_estado" value="1"
                        class="w-full px-6 py-3 text-white font-semibold rounded transition-all hover:opacity-90 flex items-center justify-center gap-2"
                        style="background-color: var(--accent-primary);">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Descargar Excel
                </button>
            </div>
        </div>

    </form>
</section>

<script>
// Auto-completar empleados seg煤n centro (si es Pro)
{% if plan_config.show_center_selector %}
const centro1 = document.getElementById('centro1');
const empleado1 = document.getElementById('empleado1');

centro1.addEventListener('change', function() {
    if (!centro1.value) return;

    fetch(`/admin/api/employees?centro=${encodeURIComponent(centro1.value)}`)
        .then(res => res.json())
        .then(data => {
            empleado1.innerHTML = '<option value="">Seleccionar empleado...</option>';
            data.forEach(emp => {
                const option = document.createElement('option');
                option.value = emp.id;
                option.textContent = `${emp.full_name} (${emp.username})`;
                empleado1.appendChild(option);
            });
        });
});
{% endif %}

// Establecer fecha de hoy por defecto
const hoy = new Date().toISOString().split('T')[0];
document.getElementById('fecha_fin1').value = hoy;
document.getElementById('fecha_fin2').value = hoy;

// Establecer inicio de mes por defecto
const inicioMes = new Date();
inicioMes.setDate(1);
const inicioMesStr = inicioMes.toISOString().split('T')[0];
document.getElementById('fecha_inicio1').value = inicioMesStr;
document.getElementById('fecha_inicio2').value = inicioMesStr;
</script>

{% endblock %}
